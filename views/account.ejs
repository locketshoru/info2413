<!-- File Purpose: Account summary and details. -->

<!-- 
THINGS TO DO ON THIS PAGE:

-Be able to upload avatar
-Be able to change user information
-If employee, only show last five orders completed. This is by a if order.cashier == user that currently isn't working.

-->

<%- include ('partials/header', {user: user, isLogged: isLogged}) %>


		<form method="POST" action="/avatar/<%= user._id %>">
<div class="row">
	<div class="col-4"> <!-- Avatar. -->
		<div class="text-center">
			<img src="https://i.imgur.com/17COUic.png" style="width:200px;height:200px">
		</div>
	</div>	
	<div class="col-8">
		<h4>Account Details</h4>
		<hr>
			<div class="form-group">
				<label for="shipaddr_old">Display Name</label>
			<input class="form-control" disabled name="name" type="text" value="<%= user.name %>" id="name" />
			</div>
			<div class="form-group">
				<label for="shipaddr_old">Username</label>
			<input class="form-control" disabled name="username" type="text" value="<%= user.username %>" id="username">
			</div><% if (user.role == 'customer'){%>
			<div class="form-group">
				<label for="shipaddr_old">Current Shipping Address</label>
				<input class="form-control" disabled name="shipaddr" type="text" value="<%= user.shipaddr %>" id="shipaddr">
			</div>
			<div class="form-group">
				<label for="password_new">New Shipping Address</label>
				<input class="form-control mb-1" name="shipaddr" type="text" value="">
			</div><% }; %>
			<div class="form-group">
				<label for="email_old">Current Email Address</label>
				<input class="form-control" disabled name="email" type="email" value="<%= user.email %>" id="email">
			</div>
			<div class="form-group">
				<label for="email_new">New Email Address</label>
				<input class="form-control mb-1" name="email" type="email" value="">
			</div>
			<div class="text-right">
				<input class="btn btn-primary" type="submit" value="Change Details">
			</div>
	</div>
</div>
		</form>

<% if (user.role == 'admin'){%>
<div class="row mt-5 text-end">
	<p>
		<a href="">Generate Monthly Report</a> or <a href="/eacc">Edit Accounts</a>
	</p>
</div>
<% }; %>

<% if (user.role == 'customer'){%>
	<div class="row">
		<% orders.forEach(function(order){ %>
			<% if(order.customer === user){ %>
				<div class="row mt-3 mb-3">
					<div class="card border-1 rounded-1">
						<div class="row">
							<div class="col-9">
								<div class="card-body">
									<h5 class="card-title"><%= order._id %></h5>
									<p class="card-text" style="font-size:0.8rem"><%= order.item1Title %><br/><%= order.item2Title %><br/><%= order.item3Title %><br/><%= order.item4Title %><br/><%= order.item5Title %><br/></p>
								</div>
							</div>
							<div class="col-3">
								<h5 class="card-title"><%= order.orderTotal %></h5>
							</div>
						</div>
					</div>
				</div>
			<% }; %>
		<% }).sort({$natural:-1}).limit(5); %>
	</div>
<% }; %>
<% if (user.role == 'employee'){%>
	<div class="row">
		<% orders.forEach(function(order){ %>
				<div class="row my-3">
					<div class="card border-1 rounded-1">
						<div class="row">
							<div class="col-9">
								<div class="card-body">
									<h5 class="card-title"><%= order._id %></h5>
									<p class="card-text" style="font-size:0.8rem"><%= order.item1Title %><br/><%= order.item2Title %><br/><%= order.item3Title %><br/><%= order.item4Title %><br/><%= order.item5Title %><br/></p>
								</div>
							</div>
							<div class="col-3">
								<h5 class="card-title"><%= order.orderTotal %></h5>
							</div>
						</div>
					</div>
				</div>
		<% }); %>
	</div>
<% }; %>

<%- include ('partials/footer') %>